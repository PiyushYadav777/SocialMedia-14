"use strict";(self.webpackChunkSocialMedia=self.webpackChunkSocialMedia||[]).push([[353],{5799:(E,h,a)=>{a.r(h),a.d(h,{MessageModule:()=>Q});var g=a(6895),l=a(3060),Z=a(2340),e=a(4650),v=a(5869),T=a(673),c=a(3546),p=a(4633),C=a(3238);function I(t,o){1&t&&(e.TgZ(0,"div"),e._uU(1,"No messages found."),e.qZA())}function O(t,o){if(1&t){const s=e.EpF();e.TgZ(0,"mat-list-item",5),e.NdJ("click",function(){const i=e.CHM(s).$implicit,d=e.oxw(2);return e.KtG(d.openMessage(i.id))}),e._UZ(1,"img",6),e.TgZ(2,"h4",7),e._uU(3),e.qZA()()}if(2&t){const s=o.$implicit,n=e.oxw(2);e.xp6(1),e.s9C("alt",s.first_name+" "+s.last_name),e.Q6J("src",n.FILE_URL+s.profile_img,e.LSH),e.xp6(2),e.AsE("",s.first_name," ",s.last_name,"")}}function U(t,o){if(1&t&&(e.TgZ(0,"div")(1,"mat-list"),e.YNc(2,O,4,4,"mat-list-item",4),e.qZA()()),2&t){const s=e.oxw();e.xp6(2),e.Q6J("ngForOf",s.messages)}}function y(t,o){1&t&&(e.TgZ(0,"div",8),e._UZ(1,"router-outlet"),e.qZA())}let J=(()=>{class t{constructor(s,n,r){this.apiService=s,this.helperService=n,this.router=r,this.messages=[],this.FILE_URL=Z.N.FILE_URL}ngOnInit(){const s=localStorage.getItem("User");if(s){const n=JSON.parse(s);this.userId=n.user_id,this.loadMessages()}}loadMessages(){this.apiService.postData("view_message_list",{user_id:this.userId}).subscribe({next:n=>{"1"==n.status?this.messages=n.details:this.helperService.error(n.msg)},error:n=>{this.helperService.error("Error fetching messages. Please try again.")}})}openMessage(s){this.selectedUserId=s,this.router.navigate(["/messages/conversations",s])}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(v.s),e.Y36(T.W),e.Y36(l.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-message"]],decls:9,vars:3,consts:[[1,"message-page"],[1,"message-list-card"],[4,"ngIf"],["class","conversation-area",4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"message-profile-pic",3,"src","alt"],["matLine",""],[1,"conversation-area"]],template:function(s,n){1&s&&(e.TgZ(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title"),e._uU(4,"Messages"),e.qZA()(),e.TgZ(5,"mat-card-content"),e.YNc(6,I,2,0,"div",2),e.YNc(7,U,3,1,"div",2),e.qZA()(),e.YNc(8,y,2,0,"div",3),e.qZA()),2&s&&(e.xp6(6),e.Q6J("ngIf",0==n.messages.length),e.xp6(1),e.Q6J("ngIf",n.messages.length>0),e.xp6(1),e.Q6J("ngIf",n.selectedUserId))},dependencies:[g.sg,g.O5,l.lC,c.a8,c.dk,c.dn,c.n5,p.i$,p.Tg,C.X2],styles:[".message-page[_ngcontent-%COMP%]{display:flex}.message-list-card[_ngcontent-%COMP%]{width:25%;margin:15px}.message-detail[_ngcontent-%COMP%]{flex:1;padding:16px}.message-profile-pic[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover;margin-right:16px}.conversation-area[_ngcontent-%COMP%]{flex:1;padding:16px}mat-list-item[_ngcontent-%COMP%]{cursor:pointer}mat-list-item[_ngcontent-%COMP%]:hover{background-color:#495fbe}"]}),t})();var m=a(5412),f=a(4859);let N=(()=>{class t{constructor(s){this.data=s}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(m.WI))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-confirm-dialog"]],decls:8,vars:3,consts:[["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"mat-dialog-close"]],template:function(s,n){1&s&&(e.TgZ(0,"div",0)(1,"p"),e._uU(2),e.qZA()(),e.TgZ(3,"div",1)(4,"button",2),e._uU(5,"Yes"),e.qZA(),e.TgZ(6,"button",2),e._uU(7,"No"),e.qZA()()),2&s&&(e.xp6(2),e.Oqu(n.data.message),e.xp6(2),e.Q6J("mat-dialog-close",!0),e.xp6(2),e.Q6J("mat-dialog-close",!1))},dependencies:[f.lW,m.ZT,m.xY,m.H8]}),t})();var _=a(1572),D=a(9549),M=a(4144),x=a(7392),u=a(4006);function S(t,o){1&t&&e._UZ(0,"mat-spinner")}function A(t,o){1&t&&(e.TgZ(0,"div"),e._uU(1,"No messages found."),e.qZA())}const b=function(t,o){return{"sent-message":t,"received-message":o}};function P(t,o){if(1&t){const s=e.EpF();e.TgZ(0,"mat-list-item",7)(1,"h4",8),e._uU(2),e.qZA(),e.TgZ(3,"p",8),e._uU(4),e.qZA(),e.TgZ(5,"img",9),e.NdJ("click",function(){const i=e.CHM(s).$implicit,d=e.oxw(2);return e.KtG(d.openDeleteDialog(i.id))}),e.qZA()()}if(2&t){const s=o.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.WLB(3,b,s.sender_id==n.userId,s.sender_id!==n.userId)),e.xp6(2),e.hij(" ",s.sender_id==n.userId?"You":s.sender_first_name," "),e.xp6(2),e.Oqu(s.message)}}function Y(t,o){if(1&t&&(e.TgZ(0,"div")(1,"mat-list"),e.YNc(2,P,6,6,"mat-list-item",6),e.qZA()()),2&t){const s=e.oxw();e.xp6(2),e.Q6J("ngForOf",s.messages)}}const F=[{path:"",component:J,children:[{path:"conversations/:userId",component:(()=>{class t{constructor(s,n,r,i){this.route=s,this.apiService=n,this.router=r,this.dialog=i,this.messages=[],this.newMessage=""}ngOnInit(){const s=localStorage.getItem("User");if(s){const n=JSON.parse(s);this.userId=n.user_id}this.route.params.subscribe(n=>{this.otherUserId=Number(n.userId),console.log("Received userId from route params:",this.otherUserId),isNaN(this.otherUserId)?console.error("No valid userId found in route params."):this.loadMessages()})}loadMessages(){const s=localStorage.getItem("User");if(s){let r={user_id:JSON.parse(s).user_id,other_user_id:this.otherUserId};this.apiService.postData("get_message",r).subscribe({next:i=>{"1"==i.status?this.messages=i.data:console.error(i.msg)},error:i=>{console.error("Error fetching messages. Please try again.")}})}}sendMessage(){const s=localStorage.getItem("User");if(s&&this.newMessage.trim()){let r={sender_id:JSON.parse(s).user_id,receiver_id:this.otherUserId,message:this.newMessage};this.apiService.postData("send_message",r).subscribe({next:i=>{"1"==i.status?(this.messages.push({message:this.newMessage,sender_first_name:"You"}),this.newMessage="",this.loadMessages()):console.error(i.msg)},error:i=>{console.error("Error sending message. Please try again.")}})}}closeConversation(){this.router.navigate(["/messages"])}selectMessage(s){this.selectedMessage=s}openDeleteDialog(s){this.dialog.open(N,{data:{message:"Are you sure you want to delete this message?"}}).afterClosed().subscribe(r=>{r&&this.deleteMessage(s)})}deleteMessage(s){const n=localStorage.getItem("User");if(n){const r=JSON.parse(n);this.apiService.postData("delete_message",{message_id:s,user_id:r.user_id}).subscribe({next:d=>{"1"==d.status?this.messages=this.messages.filter(j=>j.id!==s):console.error(d.msg)}})}}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(l.gz),e.Y36(v.s),e.Y36(l.F0),e.Y36(m.uw))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-conversations"]],decls:12,vars:4,consts:[[1,"conversation-page"],[1,"conversation-list-card"],["mat-button","",1,"close-button",3,"click"],[4,"ngIf"],["matInput","","placeholder","Type your message...",3,"ngModel","ngModelChange"],["width","64","height","64","src","https://img.icons8.com/arcade/64/sent.png","alt","sent",3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],["matLine",""],["width","12","height","12","src","https://img.icons8.com/material-rounded/24/delete-forever.png","alt","delete-forever",3,"click"]],template:function(s,n){1&s&&(e.TgZ(0,"div",0)(1,"mat-card",1)(2,"button",2),e.NdJ("click",function(){return n.closeConversation()}),e.TgZ(3,"mat-icon"),e._uU(4,"close"),e.qZA()(),e.TgZ(5,"mat-card-content"),e.YNc(6,S,1,0,"mat-spinner",3),e.YNc(7,A,2,0,"div",3),e.YNc(8,Y,3,1,"div",3),e.TgZ(9,"mat-form-field")(10,"textarea",4),e.NdJ("ngModelChange",function(i){return n.newMessage=i}),e.qZA()(),e.TgZ(11,"img",5),e.NdJ("click",function(){return n.sendMessage()}),e.qZA()()()()),2&s&&(e.xp6(6),e.Q6J("ngIf",0==n.messages.length),e.xp6(1),e.Q6J("ngIf",0==n.messages.length),e.xp6(1),e.Q6J("ngIf",n.messages.length>0),e.xp6(2),e.Q6J("ngModel",n.newMessage))},dependencies:[g.mk,g.sg,g.O5,c.a8,c.dn,_.Ou,p.i$,p.Tg,C.X2,f.lW,D.KE,M.Nt,x.Hw,u.Fj,u.JJ,u.On],styles:[".conversation-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-right:40px}.conversation-list-card[_ngcontent-%COMP%]{margin:15px;width:100%}.message-profile-pic[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover;margin-right:16px}.sent-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin:10px;border-radius:5px}.received-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin:10px;border-radius:5px}mat-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}mat-list-item[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}mat-form-field[_ngcontent-%COMP%]{width:90%}h4[_ngcontent-%COMP%]{color:#0923b3}button[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]}),t})()}]}];let w=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[l.Bz.forChild(F),l.Bz]}),t})(),Q=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[g.ez,w,c.QW,_.Cq,p.ie,f.ot,M.c,x.Ps,u.u5,m.Is]}),t})()}}]);